<!DOCTYPE html>
<html lang="es" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aceitera - Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js"></script>
</head>
<body class="d-flex flex-column h-100">
    <main class="flex-shrink-0">
        <div class="container">
            <h3 class="my-3">Lista de Productos</h3>
            <!-- Tabla de Productos -->
            <table class="table">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>Categoría</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="product-list">
                    <!-- Productos serán añadidos aquí por JavaScript -->
                </tbody>
            </table>
            <div class="col-12">
                <a href="nuevo.html" class="btn btn-primary my-3">Agregar Nuevo Producto</a>
            </div>
        </div>
    </main>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };

        // Inicializa Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // Función para cargar productos desde Firestore
        async function cargarProductos() {
            const container = document.getElementById('product-list');
            container.innerHTML = ''; // Limpiar la tabla

            try {
                const querySnapshot = await db.collection('productos').get();
                querySnapshot.forEach((doc) => {
                    const product = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.codigo}</td>
                        <td>${product.nombre}</td>
                        <td>${product.precio}</td>
                        <td>${product.cantidad}</td>
                        <td>${product.categoria || 'N/A'}</td>
                        <td>
                            <a href="editar.html?id=${doc.id}" class="btn btn-warning btn-sm">Editar</a>
                            <button onclick="eliminarProducto('${doc.id}')" class="btn btn-danger btn-sm">Eliminar</button>
                        </td>
                    `;
                    container.appendChild(row);
                });
            } catch (error) {
                console.error('Error al cargar productos:', error);
            }
        }

        // Función para eliminar un producto en Firestore
        async function eliminarProducto(id) {
            if (confirm('¿Estás seguro de eliminar este producto?')) {
                try {
                    await db.collection('productos').doc(id).delete();
                    alert('Producto eliminado');
                    cargarProductos(); // Recargar la lista
                } catch (error) {
                    console.error('Error al eliminar producto:', error);
                }
            }
        }

        // Llama a la función para cargar productos cuando se carga la página
        cargarProductos();
    </script>
</body>
</html>
