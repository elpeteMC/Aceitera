<!DOCTYPE html>
<html lang="es" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aceitera - Lista de Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
</head>
<body class="d-flex flex-column h-100">
    <header class="bg-primary text-white text-center py-3">
        <h1>Aceitera - Lista de Productos</h1>
    </header>
    <main class="flex-shrink-0">
        <div class="container mt-4">
            <h3 class="mb-4">Productos Disponibles</h3>
            <!-- Tabla para mostrar los productos -->
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="product-list">
                    <!-- Productos serán añadidos aquí dinámicamente por JavaScript -->
                </tbody>
            </table>
            <div class="d-flex justify-content-end">
                <a href="nuevo.html" class="btn btn-success">Agregar Nuevo Producto</a>
            </div>
            <!-- Botones adicionales -->
            <div class="mt-4 d-flex justify-content-between">
                <a href="ventas.html" class="btn btn-info">Gestionar Ventas</a>
                <a href="inventario.html" class="btn btn-warning">Ver Inventario</a>
            </div>
        </div>
    </main>
    <footer class="mt-auto bg-light text-center py-3">
        <small>Sistema de Gestión de Aceitera &copy; 2024</small>
    </footer>

    <script>
        // Función para cargar productos desde la API
        async function cargarProductos() {
            const container = document.getElementById('product-list');
            container.innerHTML = ''; // Limpiar la tabla antes de cargar datos

            try {
                const response = await fetch('https://aceitera.onrender.com/productos'); // URL del backend
                if (!response.ok) throw new Error('Error al obtener productos');
                
                const productos = await response.json();
                
                if (productos.length === 0) {
                    container.innerHTML = `<tr><td colspan="5" class="text-center">No hay productos disponibles</td></tr>`;
                    return;
                }

                productos.forEach((producto) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${producto.id}</td>
                        <td>${producto.nombre}</td>
                        <td>Q${producto.precio.toFixed(2)}</td>
                        <td>${producto.cantidad}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="eliminarProducto(${producto.id})">Eliminar</button>
                        </td>
                    `;
                    container.appendChild(row);
                });
            } catch (error) {
                console.error('Error al cargar productos:', error);
                alert('No se pudieron cargar los productos. Intenta de nuevo más tarde.');
            }
        }

        // Función para eliminar un producto
        async function eliminarProducto(id) {
            if (!confirm('¿Estás seguro de que deseas eliminar este producto?')) return;

            try {
                const response = await fetch(`https://api.aceitera.com/productos/${id}`, {
                    method: 'DELETE',
                });

                if (!response.ok) throw new Error('Error al eliminar producto');

                alert('Producto eliminado con éxito');
                cargarProductos(); // Recargar lista de productos
            } catch (error) {
                console.error('Error al eliminar producto:', error);
                alert('No se pudo eliminar el producto. Intenta de nuevo.');
            }
        }

        // Cargar los productos al cargar la página
        document.addEventListener('DOMContentLoaded', cargarProductos);
    </script>
</body>
</html>
