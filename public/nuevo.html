<!DOCTYPE html>
<html lang="es" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aceitera - Agregar Producto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
</head>
<body class="d-flex flex-column h-100">
    <header class="bg-primary text-white text-center py-3">
        <h1>Aceitera - Agregar Producto</h1>
    </header>
    <main class="flex-shrink-0">
        <div class="container mt-4">
            <h3 class="mb-4">Nuevo Producto</h3>
            <form id="product-form" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre del Producto</label>
                    <input type="text" id="nombre" class="form-control" required>
                    <div class="invalid-feedback">Por favor, ingresa el nombre del producto.</div>
                </div>
                <div class="mb-3">
                    <label for="precio" class="form-label">Precio (Q)</label>
                    <input type="number" id="precio" class="form-control" step="0.01" min="0.01" required>
                    <div class="invalid-feedback">Por favor, ingresa un precio válido.</div>
                </div>
                <div class="mb-3">
                    <label for="cantidad" class="form-label">Cantidad</label>
                    <input type="number" id="cantidad" class="form-control" min="1" required>
                    <div class="invalid-feedback">Por favor, ingresa una cantidad válida.</div>
                </div>
                <div class="d-flex justify-content-between">
                    <a href="index.html" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary">Guardar Producto</button>
                </div>
            </form>
        </div>
    </main>
    <footer class="mt-auto bg-light text-center py-3">
        <small>Sistema de Gestión de Aceitera &copy; 2024</small>
    </footer>

    <script>
        // Validación del formulario
        (() => {
            const form = document.getElementById('product-form');
            form.addEventListener('submit', async (event) => {
                event.preventDefault(); // Evita el envío predeterminado
                event.stopPropagation();

                if (form.checkValidity()) {
                    // Llamar a la función para agregar producto
                    await agregarProducto();
                }

                form.classList.add('was-validated');
            });
        })();

        // Función para agregar un nuevo producto
        async function agregarProducto() {
            const nombre = document.getElementById('nombre').value.trim();
            const precio = parseFloat(document.getElementById('precio').value);
            const cantidad = parseInt(document.getElementById('cantidad').value, 10);

            // Validación adicional (opcional)
            if (!nombre || precio <= 0 || cantidad <= 0) {
                alert('Por favor, completa todos los campos correctamente.');
                return;
            }

            try {
                const response = await fetch('https://aceitera.onrender.com/productos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ nombre, precio, cantidad }),
                });

                if (!response.ok) throw new Error('Error al agregar el producto.');

                alert('Producto agregado con éxito.');
                window.location.href = 'index.html'; // Redirigir al listado de productos
            } catch (error) {
                console.error('Error al agregar producto:', error);
                alert('No se pudo agregar el producto. Intenta de nuevo más tarde.');
            }
        }
    </script>
</body>
</html>
